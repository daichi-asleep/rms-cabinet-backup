<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>RMS Cabinet Backup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: "Yu Gothic", sans-serif; margin: 0; background: #f4f7fc; }
header { background: #d7000f; color: #fff; padding: 15px; text-align: center; font-size: 20px; }
.container { padding: 16px; max-width: 1000px; margin: auto; }
.folder-list { margin-top: 8px; }
.folder { background: #fff; padding: 14px; border-radius: 8px; margin-bottom: 10px;
          border: 1px solid #e3e6ec; display: flex; justify-content: space-between; align-items: center; }
.folder:hover { background: #fff8f8; cursor: pointer; }
button { background: #d7000f; color: #fff; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
button:active { opacity: .8; }
@media(max-width: 550px){ .folder { flex-direction: column; align-items: flex-start; gap: 10px; } }
</style>

</head>
<body>
<header>RMS ã‚­ãƒ£ãƒ“ãƒãƒƒãƒˆ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</header>
<div class="container">
  <div id="loading">ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ã‚’å–å¾—ä¸­...</div>
  <div id="folderList" class="folder-list"></div>
</div>

<script>
async function loadFolders() {
  const res = await fetch("/api/folders");
  const folders = await res.json();
  document.getElementById("loading").style.display = "none";

  const container = document.getElementById("folderList");
  folders.forEach(f => {
    const div = document.createElement("div");
    div.className = "folder";
    div.innerHTML = `
      <div>
        ğŸ“ <b>${f.FolderName}</b><br>
        <small>${f.FolderPath}</small>
      </div>
      <button onclick="downloadZip('${f.FolderId}', '${f.FolderName}')">ZIP ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    `;
    container.appendChild(div);
  });
}

async function downloadZip(id, name) {
  if (!confirm(name + " ã‚’ZIPã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã‹ï¼Ÿ")) return;

  const res = await fetch("/api/zip", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ folderId: id })
  });

  const blob = await res.blob();
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `${name}.zip`;
  a.click();
  window.URL.revokeObjectURL(url);
}

loadFolders();
</script>
</body>
</html>
